// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.5.2 <0.9.0;

contract lottery
{      // creating a manager which will control the lottery system , its of address type 
    address public manager; // only one manager
    
    // creating the dynamic array for participants,its also address type
    address payable [] public participants; //more than one participany

    constructor()
    {
        manager=msg.sender; // global variable

    }
    
    // receive is a special type of function, which will push the address of participant in participant array
 receive() external payable
 {
     require(msg.value==1 ether); // agar ye line true he tabhi next line execute hogi
     participants.push(payable(msg.sender));
 }
 
 // to get the balance ,this authority is given to manager , as msg.sender== manager ,then only it will work
 function getBalance() public view returns(uint){
     require(msg.sender==manager);  // only mamanger can access the balance 
     return address(this).balance;   
 }

// function to select participant on random base
// here we are using keccak algo to generate the random no , which will be used to get the winner
function random() public view returns(uint)
{
    return uint(keccak256(abi.encodePacked(block.difficulty,block.timestamp,participants.length)));
}


// this function can be call by only manager 
function selectWinner() public
{
    require(msg.sender==manager);   // here manager has the control over the lottery ,
    require(participants.length>=3); // condition participants no should be > =3

    uint r=random();
    address payable winner;
    uint index=r%participants.length;  // here we are dividing the random no generated by random function by no of participant ,it will give the value less then paricipant no
    // (r can be any random no)5/ (no of participant )3=0,1,2 (these value can be generated if no of participant are 3
    
    winner=participants[index];
     winner.transfer(getBalance());   // transfering the ammount to winner
     participants=new address payable[](0);  // here we are reseting the participant array , for new lottery, after finishing the previous lottery 
} 
}
